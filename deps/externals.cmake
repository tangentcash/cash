# Resolve external dependencies
find_path(SECP256K1_LOCATION secp256k1.h)
find_path(GMP_LOCATION gmp.h)
find_path(SODIUM_LOCATION sodium.h)
find_path(ROCKSDB_LOCATION rocksdb/db.h)
find_path(GPROTOBUF_LOCATION google/protobuf/arena.h)
if (SECP256K1_LOCATION)
	target_include_directories(tangentcash PRIVATE ${SECP256K1_LOCATION})
	find_package(unofficial-secp256k1 CONFIG QUIET)
	if (NOT unofficial-secp256k1_FOUND)
		find_library(SECP256K1_PATH NAMES "secp256k1")
		if (SECP256K1_PATH)
			set(SECP256K1_LIBRARIES "${SECP256K1_PATH}")
		endif()
	endif()
	if (unofficial-secp256k1_FOUND OR SECP256K1_LIBRARIES)
		if (DEFINED SECP256K1_LIBRARIES)
			string(STRIP "${SECP256K1_LIBRARIES}" SECP256K1_LIBRARIES)
			target_link_libraries(tangentcash PRIVATE ${SECP256K1_LIBRARIES})
		else()
			target_link_libraries(tangentcash PRIVATE unofficial::secp256k1 unofficial::secp256k1_precomputed)
		endif()
		message(STATUS "Load required library @secp256k1 - OK")
	else()
		message(FATAL_ERROR "Load required library @secp256k1 - lib not found")
	endif()
else()
	message(FATAL_ERROR "Load required library @secp256k1 - include not found")
endif()
if (GMP_LOCATION)
	target_include_directories(tangentcash PRIVATE ${GMP_LOCATION})
	find_package(PkgConfig CONFIG QUIET)
	if (PkgConfig_FOUND)
		pkg_check_modules(gmpxx QUIET IMPORTED_TARGET gmpxx)
	endif()
	if (NOT gmpxx_FOUND)
		find_library(GMP_PATH NAMES "gmp")
		if (GMP_PATH)
			set(GMP_LIBRARIES "${GMP_PATH}")
		endif()
	endif()
	if (gmpxx_FOUND OR GMP_LIBRARIES)
		if (DEFINED GMP_LIBRARIES)
			string(STRIP "${GMP_LIBRARIES}" GMP_LIBRARIES)
			target_link_libraries(tangentcash PRIVATE ${GMP_LIBRARIES})
		else()
			target_link_libraries(tangentcash PRIVATE PkgConfig::gmpxx)
		endif()
		message(STATUS "Load required library @gmp - OK")
	else()
		message(FATAL_ERROR "Load required library @gmp - lib not found")
	endif()
else()
	message(FATAL_ERROR "Load required library @gmp - include not found")
endif()
if (SODIUM_LOCATION)
	target_include_directories(tangentcash PRIVATE ${SODIUM_LOCATION})
	find_package(unofficial-sodium CONFIG QUIET)
	if (NOT unofficial-sodium_FOUND)
		find_library(SODIUM_PATH NAMES "sodium")
		if (SODIUM_PATH)
			set(SODIUM_LIBRARIES "${SODIUM_PATH}")
		endif()
	endif()
	if (unofficial-sodium_FOUND OR SODIUM_LIBRARIES)
		if (DEFINED SODIUM_LIBRARIES)
			string(STRIP "${SODIUM_LIBRARIES}" SODIUMLIBRARIES)
			target_link_libraries(tangentcash PRIVATE ${SODIUM_LIBRARIES})
		else()
			target_link_libraries(tangentcash PRIVATE unofficial-sodium::sodium)
		endif()
		message(STATUS "Load required library @sodium - OK")
	else()
		message(FATAL_ERROR "Load required library @sodium - lib not found")
	endif()
else()
	message(FATAL_ERROR "Load required library @sodium - include not found")
endif()
if (ROCKSDB_LOCATION)
	target_include_directories(tangentcash PRIVATE ${ROCKSDB_LOCATION})
	find_package(Rocksdb CONFIG QUIET)
	if (NOT Rocksdb_FOUND)
		find_library(ROCKSDB_PATH NAMES "rocksdb")
		if (ROCKSDB_PATH)
			set(ROCKSDB_LIBRARIES "${ROCKSDB_PATH}")
			target_compile_definitions(tangentcash PRIVATE -DTAN_ROCKSDB)
		endif()
	else()
		target_compile_definitions(tangentcash PRIVATE -DTAN_ROCKSDB)
	endif()
	if (Rocksdb_FOUND OR ROCKSDB_LIBRARIES)
		if (DEFINED ROCKSDB_LIBRARIES)
			string(STRIP "${ROCKSDB_LIBRARIES}" ROCKSDB_LIBRARIES)
			target_link_libraries(tangentcash PRIVATE ${ROCKSDB_LIBRARIES})
		else()
			target_link_libraries(tangentcash PRIVATE RocksDB::rocksdb)
		endif()
		message(STATUS "Load library @rocksdb - OK")
	else()
		message("Load library @rocksdb - lib not found")
	endif()
else()
	message("Load library @rocksdb - include not found")
endif()
if (GPROTOBUF_LOCATION)
	target_include_directories(tangentcash PRIVATE ${GPROTOBUF_LOCATION})
	find_package(Protobuf CONFIG QUIET)
	if (NOT Protobuf_FOUND)
		find_library(GPROTOBUF_PATH NAMES "protobuf")
		if (GPROTOBUF_PATH)
			set(GPROTOBUF_LIBRARIES "${GPROTOBUF_PATH}")
			target_compile_definitions(tangentcash PRIVATE -DTAN_PROTOBUF)
		endif()
	else()
		target_compile_definitions(tangentcash PRIVATE -DTAN_PROTOBUF)
	endif()
	if (Protobuf_FOUND OR GPROTOBUF_LIBRARIES)
		if (DEFINED GPROTOBUF_LIBRARIES)
			string(STRIP "${GPROTOBUF_LIBRARIES}" GPROTOBUF_LIBRARIES)
			target_link_libraries(tangentcash PRIVATE ${GPROTOBUF_LIBRARIES})
		else()
			target_link_libraries(tangentcash PRIVATE protobuf::libprotoc protobuf::libprotobuf protobuf::libprotobuf-lite)
		endif()
		if (CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
			set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fclang-abi-compat=17")
		endif()
		message(STATUS "Load library @protobuf - OK")
		protobuf_generate(TARGET tangentcash LANGUAGE cpp
			IMPORT_DIRS "${PROJECT_SOURCE_DIR}/src/tangent/validator/internal/libtron"
			PROTOC_OUT_DIR "${PROJECT_SOURCE_DIR}/src/tangent/validator/internal/libtron")
	else()
		message("Load library @protobuf - lib not found")
	endif()
else()
	message("Load library @protobuf - include not found")
endif()
unset(SECP256K1_LOCATION CACHE)
unset(SECP256K1_LIBRARIES CACHE)
unset(unofficial-secp256k1_DIR CACHE)
unset(GMP_LOCATION CACHE)
unset(GMP_LIBRARIES CACHE)
unset(GMP_PATH CACHE)
unset(gmpxx_DIR CACHE)
unset(PkgConfig_DIR CACHE)
unset(SODIUM_LOCATION CACHE)
unset(SODIUM_LIBRARIES CACHE)
unset(unofficial-sodium_DIR CACHE)
unset(ROCKSDB_LOCATION CACHE)
unset(ROCKSDB_LIBRARIES CACHE)
unset(ROCKSDB_PATH CACHE)
unset(Rocksdb_DIR CACHE)
unset(absl_DIR CACHE)
unset(utf8_range_DIR CACHE)
unset(GPROTOBUF_LOCATION CACHE)
unset(GPROTOBUF_LIBRARIES CACHE)
unset(GPROTOBUF_PATH CACHE)
unset(Protobuf_DIR CACHE)
unset(Protobuf_PROTOC_EXECUTABLE CACHE)
unset(Protobuf_DIR CACHE)
unset(Protobuf_PROTOC_EXECUTABLE CACHE)