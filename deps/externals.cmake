# Resolve external dependencies
set(TAN_SECP256K1 ON CACHE BOOL "Enable secp256k1 library")
set(TAN_GMP ON CACHE BOOL "Enable gmp library")
set(TAN_SODIUM ON CACHE BOOL "Enable sodium library")
set(TAN_PROTOBUF ON CACHE BOOL "Enable protobuf library")
if (TAN_SECP256K1)
	find_path(SECP256K1_LOCATION secp256k1.h)
	if (SECP256K1_LOCATION)
		target_include_directories(tangent PRIVATE ${SECP256K1_LOCATION})
		find_package(unofficial-secp256k1 CONFIG QUIET)
		if (NOT unofficial-secp256k1_FOUND)
			find_library(SECP256K1_PATH NAMES "secp256k1")
			if (SECP256K1_PATH)
				set(SECP256K1_LIBRARIES "${SECP256K1_PATH}")
				target_compile_definitions(tangent PRIVATE -DTAN_SECP256K1)
			endif()
		else()
			target_compile_definitions(tangent PRIVATE -DTAN_SECP256K1)
		endif()
		if (unofficial-secp256k1_FOUND OR SECP256K1_LIBRARIES)
			if (DEFINED SECP256K1_LIBRARIES)
				string(STRIP "${SECP256K1_LIBRARIES}" SECP256K1_LIBRARIES)
				target_link_libraries(tangent PRIVATE ${SECP256K1_LIBRARIES})
			else()
				target_link_libraries(tangent PRIVATE unofficial::secp256k1 unofficial::secp256k1_precomputed)
			endif()
			message(STATUS "secp256k1 library found")
		else()
			message(WARNING "secp256k1 library was not found")
		endif()
	else()
		message(WARNING "secp256k1 library was not found")
	endif()
    unset(SECP256K1_LOCATION CACHE)
    unset(SECP256K1_LIBRARIES CACHE)
    unset(unofficial-secp256k1_DIR CACHE)
endif()
if (TAN_GMP)
	find_path(GMP_LOCATION gmp.h)
	if (GMP_LOCATION)
		target_include_directories(tangent PRIVATE ${GMP_LOCATION})
		find_package(PkgConfig CONFIG QUIET)
		if (PkgConfig_FOUND)
			pkg_check_modules(gmpxx QUIET IMPORTED_TARGET gmpxx)
		endif()
		if (NOT gmpxx_FOUND)
			find_library(GMP_PATH NAMES "gmp")
			if (GMP_PATH)
				set(GMP_LIBRARIES "${GMP_PATH}")
				target_compile_definitions(tangent PRIVATE -DTAN_GMP)
			endif()
		else()
			target_compile_definitions(tangent PRIVATE -DTAN_GMP)
		endif()
		if (gmpxx_FOUND OR GMP_LIBRARIES)
			if (DEFINED GMP_LIBRARIES)
				string(STRIP "${GMP_LIBRARIES}" GMP_LIBRARIES)
				target_link_libraries(tangent PRIVATE ${GMP_LIBRARIES})
			else()
				target_link_libraries(tangent PRIVATE PkgConfig::gmpxx)
			endif()
			message(STATUS "gmp library found")
		else()
			message(WARNING "gmp library was not found")
		endif()
	else()
		message(WARNING "gmp library was not found")
	endif()
    unset(GMP_LOCATION CACHE)
    unset(GMP_LIBRARIES CACHE)
    unset(GMP_PATH CACHE)
    unset(gmpxx_DIR CACHE)
    unset(PkgConfig_DIR CACHE)
endif()
if (TAN_SODIUM)
	find_path(SODIUM_LOCATION sodium.h)
	if (SODIUM_LOCATION)
		target_include_directories(tangent PRIVATE ${SODIUM_LOCATION})
		find_package(unofficial-sodium CONFIG QUIET)
		if (NOT unofficial-sodium_FOUND)
			find_library(SODIUM_PATH NAMES "sodium")
			if (SODIUM_PATH)
				set(SODIUM_LIBRARIES "${SODIUM_PATH}")
				target_compile_definitions(tangent PRIVATE -DTAN_SODIUM)
			endif()
		else()
			target_compile_definitions(tangent PRIVATE -DTAN_SODIUM)
		endif()
		if (unofficial-sodium_FOUND OR SODIUM_LIBRARIES)
			if (DEFINED SODIUM_LIBRARIES)
				string(STRIP "${SODIUM_LIBRARIES}" SODIUMLIBRARIES)
				target_link_libraries(tangent PRIVATE ${SODIUM_LIBRARIES})
			else()
				target_link_libraries(tangent PRIVATE unofficial-sodium::sodium)
			endif()
			message(STATUS "sodium library found")
		else()
			message(WARNING "sodium library was not found")
		endif()
	else()
		message(WARNING "sodium library was not found")
	endif()
    unset(SODIUM_LOCATION CACHE)
    unset(SODIUM_LIBRARIES CACHE)
    unset(unofficial-sodium_DIR CACHE)
endif()
if (TAN_PROTOBUF AND TAN_VALIDATOR)
	find_path(GPROTOBUF_LOCATION google/protobuf/arena.h)
	if (GPROTOBUF_LOCATION)
		target_include_directories(tangent PRIVATE ${GPROTOBUF_LOCATION})
		target_compile_definitions(tangent PRIVATE -DTAN_PROTOBUF)
		find_package(Protobuf CONFIG QUIET)
		if (NOT Protobuf_FOUND)
			find_library(GPROTOBUF_PATH NAMES "protobuf")
			if (GPROTOBUF_PATH)
				set(GPROTOBUF_LIBRARIES "${GPROTOBUF_PATH}")
				target_compile_definitions(tangent PRIVATE -DTAN_PROTOBUF)
			endif()
		else()
			target_compile_definitions(tangent PRIVATE -DTAN_PROTOBUF)
		endif()
		if (Protobuf_FOUND OR GPROTOBUF_LIBRARIES)
			if (DEFINED GPROTOBUF_LIBRARIES)
				string(STRIP "${GPROTOBUF_LIBRARIES}" GPROTOBUF_LIBRARIES)
				target_link_libraries(tangent PRIVATE ${GPROTOBUF_LIBRARIES})
			else()
				target_link_libraries(tangent PRIVATE protobuf::libprotoc protobuf::libprotobuf protobuf::libprotobuf-lite)
			endif()
			message(STATUS "protobuf library found")
			include(deps/proto.cmake)
		else()
			message(WARNING "protobuf library was not found")
		endif()
	else()
		message(WARNING "protobuf library was not found")
	endif()
    unset(GPROTOBUF_LOCATION CACHE)
    unset(GPROTOBUF_LIBRARIES CACHE)
    unset(GPROTOBUF_PATH CACHE)
    unset(Protobuf_DIR CACHE)
    unset(Protobuf_PROTOC_EXECUTABLE CACHE)
    unset(Protobuf_DIR CACHE)
    unset(Protobuf_PROTOC_EXECUTABLE CACHE)
endif()